{{- with site.Params.homeInfoParams }}
<article class="first-entry home-info">
    <header class="entry-header">
        <h1>{{ .Title | markdownify }}</h1>
    </header>
    <div class="entry-content">
        {{ .Content | markdownify }}
    </div>

    <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(145deg, rgba(var(--primary-rgb), 0.08), rgba(var(--primary-rgb), 0.02)); border: 1px solid var(--primary); border-radius: 12px; max-width: 500px; margin-left: auto; margin-right: auto; box-shadow: 0 0 14px rgba(var(--primary-rgb), 0.25);">
      <h3 style="margin-top: 0; margin-bottom: 1rem; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; text-shadow: 0 0 8px rgba(var(--primary-rgb), 0.45);">üéõÔ∏è Boombox & Admin Command Tool</h3>
      <input type="text" id="cmdInput" placeholder="Enter Song ID here..." style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #555; background: var(--entry); color: var(--primary); font-family: monospace;">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <button onclick="showGuide()" style="padding: 12px; background: var(--primary); color: var(--theme); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.4);">üìñ How to Use?</button>
        <button onclick="copyAdminCommand()" style="padding: 12px; background: transparent; border: 2px solid var(--primary); color: var(--primary); border-radius: 8px; cursor: pointer; font-weight: bold; text-shadow: 0 0 6px rgba(var(--primary-rgb), 0.35);">üì¢ Copy Command</button>
      </div>
      <p id="dynamicGuide" style="font-size: 0.85rem; margin-top: 10px; opacity: 0.85;">To play this song, equip your Boombox, click it, and paste <strong>[ID]</strong>. Or type <strong>:music [ID]</strong> in the game chat if you have admin perms.</p>
      <p id="copyStatus" style="font-size: 0.8rem; opacity: 0.8; margin-top: 6px; text-align: center;"></p>
    </div>

    <footer class="entry-footer">
        {{ partial "social_icons.html" (dict "align" site.Params.homeInfoParams.AlignSocialIconsTo) }}
    </footer>
</article>

<script>
function getId() {
  const v = String(document.getElementById('cmdInput').value || '').trim();
  const m = v.match(/\d+/);
  return m ? m[0] : '';
}

function copyText(text) {
  if (!text) return Promise.reject();
  if (navigator.clipboard && window.isSecureContext) {
    return navigator.clipboard.writeText(text);
  }
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.position = 'fixed';
  ta.style.top = '-1000px';
  document.body.appendChild(ta);
  ta.focus();
  ta.select();
  let ok = false;
  try { ok = document.execCommand('copy'); } catch (e) { ok = false; }
  document.body.removeChild(ta);
  return ok ? Promise.resolve() : Promise.reject();
}

function setStatus(msg) {
  const el = document.getElementById('copyStatus');
  el.textContent = msg || '';
}

function updateGuide() {
  const id = getId();
  const g = document.getElementById('dynamicGuide');
  const shown = id || '[ID]';
  g.innerHTML = `To play this song, equip your Boombox, click it, and paste <strong>${shown}</strong>. Or type <strong>:music ${shown}</strong> in the game chat if you have admin perms.`;
}

function copyBoomboxId() {
  const id = getId();
  if (!id) { setStatus('Please enter a numeric ID.'); return; }
  copyText(id).then(function(){ setStatus('ID Copied! Paste it in your Boombox.'); }).catch(function(){ setStatus('Copy failed. Please copy manually.'); });
}

function copyAdminCommand() {
  const id = getId();
  if (!id) { setStatus('Please enter a numeric ID.'); return; }
  const cmd = `:music ${id}`;
  copyText(cmd).then(function(){ setStatus('Command Copied! Type it in chat.'); }).catch(function(){ setStatus('Copy failed. Please copy manually.'); });
}

function showGuide() {
  const val = String(document.getElementById('cmdInput').value || '').trim();
  if (!val) { setStatus('Please enter a numeric ID.'); return; }
  document.getElementById('guideDynamicID').innerText = getId() || val;
  document.getElementById('guideModal').style.display = 'flex';
}

function closeGuide() {
  document.getElementById('guideModal').style.display = 'none';
}

document.getElementById('cmdInput').addEventListener('input', updateGuide);
updateGuide();
</script>

<div id="guideModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
  <div style="background: var(--entry); padding: 30px; border-radius: 15px; border: 2px solid var(--primary); max-width: 90%; width: 420px; text-align: left; position: relative; box-shadow: 0 0 18px rgba(var(--primary-rgb), 0.35);">
    <h3 style="margin-top: 0; color: var(--primary);">üöÄ Quick Start Guide</h3>
    <div style="margin: 20px 0; color: var(--primary);">
      <p><strong>Step 1:</strong> Equip your Boombox/Radio.</p>
      <p><strong>Step 2:</strong> Tap it to open the window.</p>
      <p><strong>Step 3:</strong> Paste this specific ID:</p>
      <div style="background: #000; padding: 10px; border-radius: 5px; text-align: center; margin: 10px 0; border: 1px dashed #555;">
        <span id="guideDynamicID" style="font-family: monospace; font-size: 1.5rem; color: #00f3ff; font-weight: bold;">---</span>
      </div>
      <p><strong>Step 4:</strong> Hit <strong>PLAY</strong> and enjoy!</p>
    </div>
    <button onclick="closeGuide()" style="width: 100%; padding: 10px; background: var(--primary); border: none; color: var(--theme); font-weight: bold; cursor: pointer; border-radius: 5px;">Got it!</button>
  </div>
</div>
{{- end -}}
